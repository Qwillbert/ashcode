<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Ash-code</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link rel="manifest" href="manifest.json">
    <link rel="shortcut icon" href="assets/favicon.png" type="image/x-icon">
    <link rel="stylesheet" type="text/css" data-name="vs/editor/editor.main"
        href="https://cdn.jsdelivr.net/npm/monaco-editor/min/vs/editor/editor.main.css">
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.15.2/src-min-noconflict/ace.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.15.2/src-min-noconflict/mode-html.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.15.2/src-min-noconflict/ext-language_tools.js"></script>
    <script type="text/javascript" src="https://cloud9ide.github.io/emmet-core/emmet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.15.2/src-min-noconflict/ext-emmet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ace-builds@1.15.2/src-min-noconflict/ext-beautify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.7/beautify-html.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/monaco-editor/min/vs/loader.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/super-simple-popup@latest/index.css">
    <script>
        var editorJS, editorHTML;
        window.save = [{}];
        window.recent = {};
        window.functions = {};
        window.options = { autoClear: false, infiniteObjectNesting: false, autoSave: true, timeBeforeUpdate: 0.5, autoUpdate: true };
        if (localStorage.getItem('ashcodeSave') || localStorage.getItem('ashcodeRecent')) {
            alert('converting old saves to new saving system')
            save = JSON.parse(localStorage.getItem('ashcodeSave'));
            recent = JSON.parse(localStorage.getItem('ashcodeRecent'));
            localStorage.setItem('ashcodeData', JSON.stringify({
                save: save,
                recent: recent,
                options: options
            }))

            localStorage.removeItem('ashcodeSave')
            localStorage.removeItem('ashcodeRecent')
            window.location.reload();
        }
        var injectScript = `
        <!-- Injected by ash-code | Forward Facing Console -->
        <script id="ashcodeInjectedScript">
            window.console.log = function (message) { returnData('log', message) };
            window.console.error = function (message) { returnData('error', message) };
            window.console.warn = function (message) { returnData('warn', message) };
            window.onerror = function (message) { window.parent.postMessage({ type: "error", message: message }, "*") };
            window.addEventListener('message', (e) => { try { window.parent.postMessage({ type: "message", message: replaceHtmlElementsWithTags(eval(decodeURIComponent(e.data))) }, "*") } catch (error) { console.error(error) } });
            function returnData (type, message) {
                
                window.parent.postMessage({ type: type, message: replaceHtmlElementsWithTags(message) }, "*")
            }
            function replaceHtmlElementsWithTags(obj) {
  if (typeof obj === 'object') {
    if (obj instanceof HTMLElement) {
      // If the input is an HTML element, replace it with an object
      const elementData = {
        tagName: obj.tagName,
        attributes: {},
        children: replaceHtmlElementsWithTags(Array.from(obj.children)),
      };

      // Add attributes to the object
      for (let i = 0; i < obj.attributes.length; i++) {
        const attribute = obj.attributes[i];
        elementData.attributes[attribute.name] = attribute.value;
      }

      return elementData;
    } else {
      // For regular objects, process their properties
      for (const key in obj) {
        if (obj.hasOwnProperty(key)) {
          const value = obj[key];
          if (value instanceof HTMLElement) {
            // Replace HTML element with its tag name, attributes, and child elements
            obj[key] = {
              tagName: value.tagName,
              attributes: {},
              children: replaceHtmlElementsWithTags(Array.from(value.children)),
            };

            // Add attributes to the object
            for (let i = 0; i < value.attributes.length; i++) {
              const attribute = value.attributes[i];
              obj[key].attributes[attribute.name] = attribute.value;
            }
          } else if (typeof value === 'object') {
            // Recursively process nested objects
            obj[key] = replaceHtmlElementsWithTags(value);
          }
        }
      }
    }
  }
  return obj;
}
        <\/script>`

    </script>
    <style>
        :root {
            background-color: #282c34;
            margin: 0px;
            font-family: 'Courier New', Courier, monospace;
        }

        #editorHTML {
            position: absolute;
            top: env(titlebar-area-height, 20px);
            left: 0px;
            width: 100%;
            height: calc(49.9% - env(titlebar-area-height, 20px));
            border-bottom: solid white 10px;
        }

        #editorJS {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50%;
        }

        #container {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            width: 50%;
            height: 100%;
            resize: horizontal;
        }

        iframe {
            position: fixed;
            top: env(titlebar-area-height, 20px);
            right: 0;
            width: 50%;
            height: calc(100% - env(titlebar-area-height, 20px));
            z-index: -3;
            background-color: white;
        }

        iframe.fullscreen {
            position: absolute;
            top: 0px;
            left: 0px;
            width: 100%;
            height: 100%;
            z-index: 1000;
        }

        iframe.fullscreen+#fullscreenButton {
            display: block;
        }

        #fullscreenButton {
            position: fixed;
            top: 0px;
            left: 0px;
            display: none;
            z-index: 1001;
            background-color: rgba(0, 0, 0, 0.1);
            border: none;
            border-bottom-left-radius: 5px;
        }

        #controls {
            position: fixed;
            top: 0px;
            left: 0px;
            z-index: 999;
            width: 100%;
            height: env(titlebar-area-height, 20px);
            padding-left: 35px;
            -webkit-app-region: drag;
        }

        #controls>img {
            height: 20px;
            display: inline;
            position: absolute;
            left: 7.5px;
            top: 50%;
            transform: translateY(-50%);
        }

        #controls>button {
            -webkit-app-region: no-drag;
            /* background-color: rgba(255, 255, 255, 1); */
            /* border: black solid 1px; */
            border: none;
            border-radius: 5px;
            color: white;
            background-color: transparent;
            height: env(titlebar-area-height, 20px);
            box-sizing: border-box;
            border: transparent solid 1px;
        }

        #controls>button:hover {
            border: dashed white 1px;
        }

        #consoleControls>button {
            background-color: rgba(255, 255, 255, 1);
            border: black solid 1px;
            border: none;
            border-radius: 5px;
            color: white;
            background-color: transparent;
            height: 20px;
        }

        .dropdown {
            position: absolute;
            margin: 0px;
            padding: 0px;
            background-color: #282c34;
            border: 1px solid black;
            border-radius: 5px;
            display: none;
            width: 200px;
            text-align: left;
        }

        .subMenu {
            position: relative;
        }

        .subMenu>.dropdown {
            transform: translateX(95%);
            filter: none;
            position: absolute;
            top: 0px;
        }

        .subMenu::after {
            content: ">";
            position: absolute;
            right: 10px;
        }

        .dropdown>span:hover {
            background-color: #1e2127;
            cursor: pointer;
        }

        .dropdown>span {
            width: 100%;
            display: block;
            border-radius: 5px;
            padding-left: 6px;
            box-sizing: border-box;
        }

        #controls>button:hover>.dropdown,
        #controls>button>.dropdown:hover,
        .subMenu:hover>.dropdown,
        .subMenu>.dropdown:hover {
            display: block;
        }

        .dropdown>hr {
            border: solid 1px lightgray;
            background: lightgray;
            border-radius: 100px;
            margin: 2px;
        }


        .dropdown>span[data-value]::before {
            padding-right: 6px;
            padding-left: 3px;
        }

        .dropdown>span[data-value="false"]::before {
            content: "☐";
        }

        .dropdown>span[data-value="true"]::before {
            content: "⮽";
        }

        .popup-container,
        .popup-header,
        .popup-close {
            color: white;
            background-color: #282c34;
        }

        .popup-content::-webkit-scrollbar {
            width: 1px;
        }

        .popup-content {
            overflow-x: hidden;
            display: grid;
            z-index: 999999999999999 !important;
            grid-template-columns: repeat(3, 1fr);
            gap: 3px;
            background-color: #282c34;
            color: white;
        }

        .popup-content>.menuItem {
            background-color: #2d313a;
            height: 80px;
            text-align: center;
            margin: 3px;
            border-radius: 3px;
            transition: 100ms;
            cursor: pointer;
            border: dashed 1px transparent;
            text-align: center;

        }

        .popup-content>.menuItem:hover {
            background-color: #333842;
            border: dashed 1px white;
        }


        #console {
            position: fixed;
            bottom: 0px;
            right: 0px;
            z-index: 0;
            width: 50%;
            height: 300px;
            background-color: #222;
            color: #fff;
            overflow-y: auto;
        }

        #console>#log {
            color: white;
            overflow-y: scroll;
            height: calc(100% - 40px);
            top: 20px;
            display: flex;
            flex-direction: column;
        }

        #consoleControls {
            height: 20px;
            width: 100%;
            background-color: black;
        }

        #console>input {
            position: absolute;
            bottom: 0px;
            left: 0px;
            width: 100%;
            background-color: black;
            color: white;
            height: 20px;
            font-family: 'Courier New', Courier, monospace;

        }

        .message {
            background-color: rgb(0, 119, 198);
            padding-left: 10px;
            border-bottom: solid 3px rgb(1, 97, 161);

        }

        .info {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 0px 5px;

        }

        .infoB {
            background-color: rgba(255, 255, 255, 0.05);
            padding: 0px 5px;
            border-bottom: solid 3px rgba(255, 255, 255, 0.2);
        }

        .error {
            background-color: #b71c1c;
            padding: 0px 5px;
            border-bottom: solid 3px #861515;

        }

        .error::before {
            content: "⮾";
            font-weight: bold;
            margin-left: 10px;
            color: #fff;
            margin-right: 10px;
        }

        .warn {
            background-color: #ff9800;
            padding: 5px;
            border-bottom: solid 3px #b86f01;
        }

        .warn::before {
            content: "⚠";
            font-weight: bold;
            margin-left: 10px;
            color: #fff;
            margin-right: 10px;
        }

        input[type="text"] {
            background-color: #444 !important;
            color: #fff;
            border: none;
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
        }
    </style>
</head>

<body>
    <div id="controls">
        <img src="/assets/favicon.png">
        <button>File
            <div class="dropdown">
                <span onclick="functions.toggleSimpleOption(event, 'autoSave')" data-value=true
                    data-name="autoSave">Save Recent</span>
                <span onclick="functions.saveAndLoad(true)">Save</span>
                <span onclick="functions.saveAndLoad(false)">Load</span>
                <span onclick="location.href = 'ashcode/projectViewer.html'">Project Gallery</span>
                <span class="subMenu">Import
                    <div class="dropdown">
                        <span onclick="functions.importAll()">Import projects from File</span>
                        <span onclick="functions.importWorkspace()">Import Workspace from HTML File</span>
                        <span onclick="location.href = 'ashcode/projectViewer.html?import'">Import projects from Project
                            Gallery</span>
                    </div>
                </span>
                <span class="subMenu">Export
                    <div class="dropdown">
                        <span onclick="functions.exportAll()">Export All projects to File</span>
                        <span onclick="functions.downloadWorkspace()">Download Current Workspace as HTML</span>
                        <span onclick="location.href = 'ashcode/projectViewer.html?export'">Export projects to Project
                            Gallery</span>
                    </div>
                </span>
                <span class="subMenu">Preferences
                    <div class="dropdown">
                        <span onclick="functions.updateTabSize()">Update Tab Size</span>
                        <span onclick="functions.toggleEnableEmmet()" data-value=true>Enable Emmet</span>
                    </div>
                </span>
            </div>
        </button>
        <button>Edit
            <div class="dropdown">
                <span onclick="functions.formatWorkspace()">Format</span>
                <span onclick="functions.resetWorkspace()">Reset</span>
            </div>
        </button>
        <button>View
            <div class="dropdown">
                <span onclick="functions.openInNewTab()">Open in new Tab</span>
                <span onclick="functions.fullscreen()">Fullscreen</span>
                <span class="subMenu">Auto-Update
                    <div class="dropdown">
                        <span onclick="functions.toggleSimpleOption(event, 'autoUpdate')" data-value="true"
                            data-name="autoUpdate">Auto Update
                            enabled</span>
                        <span onclick="functions.updateAutoUpdateTimer()">Update time before auto-update</span>
                    </div>
                </span>
            </div>
        </button>
        <button>Console
            <div class="dropdown">
                <span onclick="functions.toggleConsole()" data-value=true>Enable Console</span>
                <span onclick="functions.toggleSimpleOption(event, 'autoClear')" data-value=false
                    data-name="autoClear">Clear Console on
                    Update</span>
                <span onclick="functions.toggleSimpleOption(event, 'infiniteObjectNesting')" data-value=false
                    data-name="infiniteObjectNesting">Allow
                    Infinite Object Nesting</span>
            </div>
        </button>
        <button onclick="functions.updateFrame(true);">Update iFrame</button>
    </div>
    <div id="container">
        <div id="editorHTML"></div>
        <div id="editorJS"></div>
    </div>
    <iframe frameborder="0"></iframe>
    <button id="fullscreenButton" onclick="functions.fullscreen()">X</button>
    <div id="console">
        <div id="consoleControls">
            <button onclick="functions.clearConsole()">Clear</button>
        </div>
        <div id="log"></div>
        <input type="text" id="send" autocomplete="off" placeholder="document.write('hello')">
    </div>
    <script type="module">
        "use strict";
        import Popup from 'https://cdn.skypack.dev/super-simple-popup'
        if (localStorage.getItem('ashcodeData')) {
            let data = JSON.parse(localStorage.getItem('ashcodeData'));
            save = data.save;
            recent = data.recent;
            options = data.options;
            for (let option in options) {
                if (options[option] === true || options[option] === false) {
                    document.querySelector(`span[data-name="${option}"]`).dataset.value = options[option].toString()
                }
            }
            document.querySelector('#controls>*:last-child').style.display = options.autoUpdate ? "none" : "unset"
        }
        require.config({ paths: { 'vs': 'https://unpkg.com/monaco-editor/min/vs' } }); window.MonacoEnvironment = { getWorkerUrl: () => proxy }; let proxy = URL.createObjectURL(new Blob([`self.MonacoEnvironment = {baseUrl: 'https://unpkg.com/monaco-editor/min/'};importScripts('https://unpkg.com/monaco-editor/min/vs/base/worker/workerMain.js');`], { type: 'text/javascript' })); require(["vs/editor/editor.main"], function () {
            ace.config.set('basePath', 'https://cdn.jsdelivr.net/npm/ace-builds@1.15.2/src-noconflict');
            const frame = document.getElementsByTagName('iframe')[0];
            monaco.editor.defineTheme('atom', {
                base: 'vs-dark',
                inherit: false,
                rules: [{ "token": "comment", "foreground": "#5C6370", "fontStyle": "italic" }, { "token": "comment markup.link", "foreground": "#5C6370" }, { "token": "entity.name.type", "foreground": "#E5C07B" }, { "token": "entity.other.inherited-class", "foreground": "#E5C07B" }, { "token": "keyword", "foreground": "#C678DD" }, { "token": "keyword.control", "foreground": "#C678DD" }, { "token": "keyword.operator", "foreground": "#C678DD" }, { "token": "keyword.other.special-method", "foreground": "#61AFEF" }, { "token": "keyword.other.unit", "foreground": "#D19A66" }, { "token": "storage", "foreground": "#C678DD" }, { "token": "storage.type.annotation", "foreground": "#C678DD" }, { "token": "storage.modifier.package", "foreground": "#ABB2BF" }, { "token": "constant", "foreground": "#D19A66" }, { "token": "constant.variable", "foreground": "#D19A66" }, { "token": "constant.character.escape", "foreground": "#56B6C2" }, { "token": "constant.numeric", "foreground": "#D19A66" }, { "token": "constant.other.color", "foreground": "#56B6C2" }, { "token": "constant.other.symbol", "foreground": "#56B6C2" }, { "token": "variable", "foreground": "#E06C75" }, { "token": "variable.interpolation", "foreground": "#BE5046" }, { "token": "variable.parameter", "foreground": "#ABB2BF" }, { "token": "string", "foreground": "#98C379" }, { "token": "string > source", "foreground": "#ABB2BF" }, { "token": "string.regexp", "foreground": "#56B6C2" }, { "token": "string.regexp source.ruby.embedded", "foreground": "#E5C07B" }, { "token": "string.other.link", "foreground": "#E06C75" }, { "token": "punctuation.definition.comment", "foreground": "#5C6370" }, { "token": "punctuation.definition.method-parameters", "foreground": "#ABB2BF" }, { "token": "punctuation.definition.heading", "foreground": "#61AFEF" }, { "token": "punctuation.definition.bold", "foreground": "#E5C07B", "fontStyle": "bold" }, { "token": "punctuation.definition.italic", "foreground": "#C678DD", "fontStyle": "italic" }, { "token": "punctuation.section.embedded", "foreground": "#BE5046" }, { "token": "punctuation.section.method", "foreground": "#ABB2BF" }, { "token": "support.class", "foreground": "#E5C07B" }, { "token": "support.type", "foreground": "#56B6C2" }, { "token": "support.function", "foreground": "#56B6C2" }, { "token": "support.function.any-method", "foreground": "#61AFEF" }, { "token": "entity.name.function", "foreground": "#61AFEF" }, { "token": "entity.name.class", "foreground": "#E5C07B" }, { "token": "entity.name.section", "foreground": "#61AFEF" }, { "token": "entity.name.tag", "foreground": "#E06C75" }, { "token": "entity.other.attribute-name", "foreground": "#D19A66" }, { "token": "entity.other.attribute-name.id", "foreground": "#61AFEF" }, { "token": "meta.class", "foreground": "#E5C07B" }, { "token": "meta.class.body", "foreground": "#ABB2BF" }, { "token": "meta.method-call", "foreground": "#ABB2BF" }, { "token": "meta.definition.variable", "foreground": "#E06C75" }, { "token": "meta.link", "foreground": "#D19A66" }, { "token": "meta.require", "foreground": "#61AFEF" }, { "token": "meta.selector", "foreground": "#C678DD" }, { "token": "meta.separator", "foreground": "#ABB2BF" }, { "token": "meta.tag", "foreground": "#ABB2BF" }, { "token": "underline" }, { "token": "none", "foreground": "#ABB2BF" }, { "token": "invalid.deprecated", "foreground": "#523D14" }, { "token": "invalid.illegal", "foreground": "#FFFFFF" }, { "token": "markup.bold", "foreground": "#D19A66", "fontStyle": "bold" }, { "token": "markup.changed", "foreground": "#C678DD" }, { "token": "markup.deleted", "foreground": "#E06C75" }, { "token": "markup.italic", "foreground": "#C678DD", "fontStyle": "italic" }, { "token": "markup.heading", "foreground": "#E06C75" }, { "token": "markup.heading punctuation.definition.heading", "foreground": "#61AFEF" }, { "token": "markup.link", "foreground": "#56B6C2" }, { "token": "markup.inserted", "foreground": "#98C379" }, { "token": "markup.quote", "foreground": "#D19A66" }, { "token": "markup.raw", "foreground": "#98C379" }, { "token": "source.c keyword.operator", "foreground": "#C678DD" }, { "token": "source.cpp keyword.operator", "foreground": "#C678DD" }, { "token": "source.cs keyword.operator", "foreground": "#C678DD" }, { "token": "source.css property-name", "foreground": "#828997" }, { "token": "source.css property-name.support", "foreground": "#ABB2BF" }, { "token": "source.elixir source.embedded.source", "foreground": "#ABB2BF" }, { "token": "source.elixir constant.language", "foreground": "#61AFEF" }, { "token": "source.elixir variable.definition", "foreground": "#C678DD" }, { "token": "source.elixir parameter.variable.function", "foreground": "#D19A66", "fontStyle": "italic" }, { "token": "source.elixir quoted", "foreground": "#98C379" }, { "token": "source.elixir keyword.special-method", "foreground": "#E06C75" }, { "token": "source.elixir readwrite.module punctuation", "foreground": "#E06C75" }, { "token": "source.elixir regexp.section", "foreground": "#BE5046" }, { "token": "source.elixir separator", "foreground": "#D19A66" }, { "token": "source.elixir variable.constant", "foreground": "#E5C07B" }, { "token": "source.elixir array", "foreground": "#828997" }, { "token": "source.gfm markup" }, { "token": "source.gfm link entity", "foreground": "#61AFEF" }, { "token": "source.go storage.type.string", "foreground": "#C678DD" }, { "token": "source.ini keyword.other.definition.ini", "foreground": "#E06C75" }, { "token": "source.java storage.modifier.import", "foreground": "#E5C07B" }, { "token": "source.java storage.type", "foreground": "#E5C07B" }, { "token": "source.java keyword.operator.instanceof", "foreground": "#C678DD" }, { "token": "source.java-properties meta.key-pair", "foreground": "#E06C75" }, { "token": "source.java-properties meta.key-pair > punctuation", "foreground": "#ABB2BF" }, { "token": "source.js keyword.operator", "foreground": "#56B6C2" }, { "token": "source.js keyword.operator.delete", "foreground": "#C678DD" }, { "token": "source.ts keyword.operator", "foreground": "#56B6C2" }, { "token": "source.flow keyword.operator", "foreground": "#56B6C2" }, { "token": "source.json meta.structure.dictionary.json > string.quoted.json", "foreground": "#E06C75" }, { "token": "source.json meta.structure.dictionary.json > string.quoted.json > punctuation.string", "foreground": "#E06C75" }, { "token": "source.json meta.structure.dictionary.json > value.json > string.quoted.json", "foreground": "#98C379" }, { "token": "source.json meta.structure.dictionary.json > constant.language.json", "foreground": "#56B6C2" }, { "token": "ng.interpolation", "foreground": "#E06C75" }, { "token": "ng.interpolation.begin", "foreground": "#61AFEF" }, { "token": "ng.interpolation function", "foreground": "#E06C75" }, { "token": "ng.interpolation function.begin", "foreground": "#61AFEF" }, { "token": "ng.interpolation bool", "foreground": "#D19A66" }, { "token": "ng.interpolation bracket", "foreground": "#ABB2BF" }, { "token": "ng.pipe", "foreground": "#ABB2BF" }, { "token": "ng.tag", "foreground": "#56B6C2" }, { "token": "ng.attribute-with-value attribute-name", "foreground": "#E5C07B" }, { "token": "ng.attribute-with-value string", "foreground": "#C678DD" }, { "token": "ng.attribute-with-value string.begin", "foreground": "#ABB2BF" }, { "token": "source.php class.bracket", "foreground": "#ABB2BF" }, { "token": "source.python keyword.operator.logical.python", "foreground": "#C678DD" }, { "token": "source.python variable.parameter", "foreground": "#D19A66" }, { "token": "c", "foreground": "#ABB2BF" }, { "token": "s", "foreground": "#ABB2BF" }, { "token": "s", "foreground": "#98C379" }, { "token": "s", "foreground": "#D19A66" }, { "token": "s", "foreground": "#E06C75" }, { "token": "s", "foreground": "#E06C75" }, { "token": "punctuation.separator.key-value.ts", "foreground": "#56B6C2" }, { "token": "source.js.embedded.html keyword.operator", "foreground": "#56B6C2" }, { "token": "variable.other.readwrite.js", "foreground": "#ABB2BF" }, { "token": "support.variable.dom.js", "foreground": "#E06C75" }, { "token": "support.variable.property.dom.js", "foreground": "#E06C75" }, { "token": "meta.template.expression.js punctuation.definition", "foreground": "#BE5046" }, { "token": "source.ts punctuation.definition.typeparameters", "foreground": "#ABB2BF" }, { "token": "source.ts punctuation.definition.block", "foreground": "#ABB2BF" }, { "token": "source.ts punctuation.separator.comma", "foreground": "#ABB2BF" }, { "token": "support.variable.property.js", "foreground": "#E06C75" }, { "token": "keyword.control.default.js", "foreground": "#E06C75" }, { "token": "keyword.operator.expression.instanceof.js", "foreground": "#C678DD" }, { "token": "keyword.operator.expression.of.js", "foreground": "#C678DD" }, { "token": "meta.brace.round.js", "foreground": "#ABB2BF" }, { "token": "source.js punctuation.accessor", "foreground": "#ABB2BF" }, { "token": "punctuation.terminator.statement.js", "foreground": "#ABB2BF" }, { "token": "meta.array-binding-pattern-variable.js variable.other.readwrite.js", "foreground": "#D19A66" }, { "token": "source.js support.variable", "foreground": "#E06C75" }, { "token": "variable.other.constant.property.js", "foreground": "#D19A66" }, { "token": "keyword.operator.new.ts", "foreground": "#C678DD" }, { "token": "source.ts keyword.operator", "foreground": "#56B6C2" }, { "token": "punctuation.separator.parameter.js", "foreground": "#ABB2BF" }, { "token": "constant.language.import-export-all.js", "foreground": "#E06C75" }, { "token": "constant.language.import-export-all.jsx", "foreground": "#56B6C2" }, { "token": "keyword.control.as.js", "foreground": "#ABB2BF" }, { "token": "variable.other.readwrite.alias.js", "foreground": "#E06C75" }, { "token": "variable.other.constant.js", "foreground": "#D19A66" }, { "token": "meta.export.default.js variable.other.readwrite.js", "foreground": "#E06C75" }, { "token": "source.js meta.template.expression.js punctuation.accessor", "foreground": "#98C379" }, { "token": "source.js meta.import-equals.external.js keyword.operator", "foreground": "#ABB2BF" }, { "token": "e", "foreground": "#98C379" }, { "token": "m", "foreground": "#ABB2BF" }, { "token": "meta.definition.property.js variable", "foreground": "#ABB2BF" }, { "token": "meta.type.parameters.js support.type", "foreground": "#ABB2BF" }, { "token": "source.js meta.tag.js keyword.operator", "foreground": "#ABB2BF" }, { "token": "meta.tag.js punctuation.section.embedded", "foreground": "#ABB2BF" }, { "token": "meta.array.literal.js variable", "foreground": "#E5C07B" }, { "token": "support.type.object.module.js", "foreground": "#E06C75" }, { "token": "constant.language.json", "foreground": "#56B6C2" }, { "token": "variable.other.constant.object.js", "foreground": "#D19A66" }, { "token": "storage.type.property.js", "foreground": "#56B6C2" }, { "token": "meta.template.expression.js string.quoted punctuation.definition", "foreground": "#98C379" }, { "token": "meta.template.expression.js string.template punctuation.definition.string.template", "foreground": "#98C379" }, { "token": "keyword.operator.expression.in.js", "foreground": "#C678DD" }, { "token": "variable.other.object.js", "foreground": "#ABB2BF" }, { "token": "meta.object-literal.key.js", "foreground": "#E06C75" }, { "token": "s", "foreground": "#ABB2BF" }, { "token": "s", "foreground": "#D19A66" }, { "token": "c", "foreground": "#D19A66" }, { "token": "s", "foreground": "#E06C75" }, { "token": "m", "foreground": "#D19A66" }, { "token": "p", "foreground": "#ABB2BF" }, { "token": "p", "foreground": "#ABB2BF" }, { "token": "e", "foreground": "#E06C75" }, { "token": "s", "foreground": "#ABB2BF" }, { "token": "v", "foreground": "#ABB2BF" }, { "token": "v", "foreground": "#ABB2BF" }, { "token": "v", "foreground": "#ABB2BF" }, { "token": "e", "foreground": "#61AFEF" }, { "token": "s", "foreground": "#E5C07B" }, { "token": "k", "foreground": "#C678DD" }, { "token": "e", "foreground": "#56B6C2" }, { "token": "s", "foreground": "#ABB2BF" }, { "token": "e", "foreground": "#D19A66" }, { "token": "s", "foreground": "#56B6C2" }, { "token": "m", "foreground": "#D19A66" }, { "token": "s", "foreground": "#56B6C2" }, { "token": "m", "foreground": "#ABB2BF" }, { "token": "p", "foreground": "#E06C75" }, { "token": "s", "foreground": "#ABB2BF" }, { "token": "p", "foreground": "#D19A66" }, { "token": "p", "foreground": "#E06C75" }, { "token": "p", "foreground": "#D19A66" }, { "token": "m", "foreground": "#ABB2BF" }, { "token": "s", "foreground": "#E5C07B" }, { "token": "e", "foreground": "#E06C75" }, { "token": "p", "foreground": "#E06C75" }, { "token": "m", "foreground": "#ABB2BF" }, { "token": "p", "foreground": "#D19A66" }, { "token": "m", "foreground": "#98C379" }, { "token": "b", "foreground": "#E06C75" }, { "token": "m", "foreground": "#5C6370", "fontStyle": "italic" }, { "token": "punctuation.definition.string.begin.markdown", "foreground": "#ABB2BF" }, { "token": "p", "foreground": "#C678DD" }, { "token": "markup.underline.link.markdown", "foreground": "#C678DD" }, { "token": "string.other.link.title.markdown", "foreground": "#61AFEF" }, { "token": "p", "foreground": "#E06C75" }, { "token": "v", "foreground": "#D19A66" }, { "token": "k", "foreground": "#98C379" }, { "token": "p", "foreground": "#E06C75" }, { "token": "m", "foreground": "#ABB2BF" }],
                colors: { "activityBar.background": "#333842", "activityBar.foreground": "#D7DAE0", "editorInlayHint.background": "#2C313A", "editorInlayHint.foreground": "#636e83", "notebook.cellEditorBackground": "#2C313A", "activityBarBadge.background": "#528BFF", "activityBarBadge.foreground": "#D7DAE0", "button.background": "#4D78CC", "button.foreground": "#FFFFFF", "button.hoverBackground": "#6087CF", "diffEditor.insertedTextBackground": "#00809B33", "dropdown.background": "#353b45", "dropdown.border": "#181A1F", "editorIndentGuide.activeBackground": "#626772", "editor.background": "#282C34", "editor.foreground": "#ABB2BF", "editor.lineHighlightBackground": "#99BBFF0A", "editor.selectionBackground": "#3E4451", "editorCursor.foreground": "#528BFF", "editor.findMatchHighlightBackground": "#528BFF3D", "editorGroup.background": "#21252B", "editorGroup.border": "#181A1F", "editorGroupHeader.tabsBackground": "#21252B", "editorIndentGuide.background": "#ABB2BF26", "editorLineNumber.foreground": "#636D83", "editorLineNumber.activeForeground": "#ABB2BF", "editorWhitespace.foreground": "#ABB2BF26", "editorRuler.foreground": "#ABB2BF26", "editorHoverWidget.background": "#21252B", "editorHoverWidget.border": "#181A1F", "editorSuggestWidget.background": "#21252B", "editorSuggestWidget.border": "#181A1F", "editorSuggestWidget.selectedBackground": "#2C313A", "editorWidget.background": "#21252B", "editorWidget.border": "#3A3F4B", "input.background": "#1B1D23", "input.border": "#181A1F", "focusBorder": "#528BFF", "list.activeSelectionBackground": "#2C313A", "list.activeSelectionForeground": "#D7DAE0", "list.focusBackground": "#2C313A", "list.hoverBackground": "#2C313A66", "list.highlightForeground": "#D7DAE0", "list.inactiveSelectionBackground": "#2C313A", "list.inactiveSelectionForeground": "#D7DAE0", "notification.background": "#21252B", "pickerGroup.border": "#528BFF", "scrollbarSlider.background": "#4E566680", "scrollbarSlider.activeBackground": "#747D9180", "scrollbarSlider.hoverBackground": "#5A637580", "sideBar.background": "#21252B", "sideBarSectionHeader.background": "#333842", "statusBar.background": "#21252B", "statusBar.foreground": "#9DA5B4", "statusBarItem.hoverBackground": "#2C313A", "statusBar.noFolderBackground": "#21252B", "tab.activeBackground": "#282C34", "tab.activeForeground": "#D7DAE0", "tab.border": "#181A1F", "tab.inactiveBackground": "#21252B", "titleBar.activeBackground": "#21252B", "titleBar.activeForeground": "#9DA5B4", "titleBar.inactiveBackground": "#21252B", "titleBar.inactiveForeground": "#9DA5B4", "statusBar.debuggingForeground": "#FFFFFF", "extensionButton.prominentBackground": "#2BA143", "extensionButton.prominentHoverBackground": "#37AF4E", "badge.background": "#528BFF", "badge.foreground": "#D7DAE0", "peekView.border": "#528BFF", "peekViewResult.background": "#21252B", "peekViewResult.selectionBackground": "#2C313A", "peekViewTitle.background": "#1B1D23", "peekViewEditor.background": "#1B1D23" }
            })
            editorJS = monaco.editor.create(document.getElementById('editorJS'), {
                language: 'javascript',
                theme: 'atom',
                fontSize: "12px",
                automaticLayout: true,
            });
            editorHTML = ace.edit('editorHTML')
            var langTools = ace.require("ace/ext/language_tools");
            editorHTML.setOptions({
                enableBasicAutocompletion: true,
                enableSnippets: true,
                enableLiveAutocompletion: true,
                enableEmmet: true,
                showPrintMargin: false,
                customScrollbar: true
            })
            editorHTML.session.on('change', function () {
                if (options.autoUpdate) {
                    functions.updateFrame(true);
                }
            });
            monaco.editor.getModels()[0].onDidChangeContent(() => {
                if (options.autoUpdate) {
                    functions.updateFrame(true);
                }
            });
            document.getElementById('editorHTML').style.fontSize = '12px'
            editorHTML.session.setMode('ace/mode/html')
            editorHTML.setTheme("ace/theme/one_dark");
            document.querySelectorAll('.dropdown > span:not(:last-child)').forEach(element => {
                let e = document.createElement('hr')
                element.insertAdjacentElement('afterEnd', e)
            })
            window.timeSinceUpdate = 0;
            functions.updateFrame = function (save) {
                timeSinceUpdate = options.timeBeforeUpdate * 1000

                if (save) {
                    functions.autoSave();
                }
            }
            setInterval(() => {
                if (timeSinceUpdate !== 0) {
                    timeSinceUpdate -= 500
                } else {
                    frame.src = `data:text/html;base64,${window.btoa(unescape(encodeURIComponent(editorHTML.env.editor.getValue() + injectScript + "<script>try{" + editorJS.getValue() + "}catch(error){console.error(error)}<\/script>")))}`;
                    if (window.options.autoClear) {
                        document.getElementById('log').innerHTML = ""
                    }
                    timeSinceUpdate -= 500
                }

            }, 500)
            functions.clearConsole = function () {
                document.getElementById('log').innerHTML = ""
            }
            functions.openInNewTab = function () {
                let n = window.open();
                n.document.write(editorHTML.env.editor.getValue() + "<script>" + editorJS.getValue() + "<\/script>")
            }
            functions.fullscreen = function () {
                frame.classList.toggle('fullscreen')
            }
            functions.formatWorkspace = function () {
                editorHTML.setValue(html_beautify(editorHTML.getValue()))
                editorJS.setValue(js_beautify(editorJS.getValue()))
            }
            functions.resetWorkspace = function () {
                editorHTML.env.editor.setValue("");
                editorJS.setValue('');
            }
            functions.saveAndLoad = function (saved) {
                if (saved) {
                    let html = functions.generateHTML("save")
                    new Popup({
                        title: 'Save your workspace',
                        plainText: false,
                        clickBackdropToClose: true,
                        content: html
                    })
                } else {
                    let html = functions.generateHTML("load")
                    new Popup({
                        title: 'Load a workspace',
                        plainText: false,
                        clickBackdropToClose: true,
                        content: html
                    })
                }
            }
            functions.autoSave = function () {
                if (options.autoSave) {
                    window.recent = {};
                    window.recent.js = encodeURIComponent(editorJS.getValue());
                    window.recent.html = encodeURIComponent(editorHTML.getValue());
                    window.recent.name = `Recent Project - ${new Date().toLocaleDateString() + ", " + new Date().toLocaleTimeString()}`

                    localStorage.setItem('ashcodeData', JSON.stringify({
                        save: save,
                        recent: recent,
                        options: options
                    }))
                }
            }
            functions.generateHTML = function (type) {
                if (type == "save") {
                    var html = ""

                    for (let i = 0; i < save.length; i++) {
                        const s = save[i];
                        html += `<div class="menuItem save" onclick="functions.modifySave('overwrite', ${i})" oncontextmenu="event.preventDefault(); functions.modifySave('remove', ${i})">${s.name ? s.name : "Empty"}</div>`;
                    }
                    html += `<div class="menuItem save" onclick="functions.modifySave('new')">+</div>`
                    return html
                } else if (type == "load") {
                    var html = ""
                    if (recent && recent.name) {
                        html += `<div class="menuItem save" onclick="functions.modifySave('load', 'recent')">${recent.name}</div>`
                    }
                    for (let i = 0; i < save.length; i++) {
                        const s = save[i];
                        html += `<div class="menuItem save" onclick="functions.modifySave('load', ${i})">${s.name ? s.name : "Empty"}</div>`;
                    }
                    return html
                }
            }
            functions.modifySave = function (f, id) {
                if (f == "overwrite") {
                    let a = prompt("Save name", save[id].name);
                    if (a != null) {
                        save[id].name = a;
                        save[id].html = encodeURIComponent(editorHTML.getValue());
                        save[id].js = encodeURIComponent(editorJS.getValue());
                        document.querySelector('.popup-close').click()
                    } else {
                        alert('Canceled!')
                    }
                } else if (f == "new") {
                    save.push({})
                } else if (f == "load") {
                    if (id == 'recent' && recent) {
                        console.log(recent);
                        document.querySelector('.popup-close').click();
                        options.autoSave = false;
                        editorJS.setValue(decodeURIComponent(recent.js));
                        editorHTML.setValue(decodeURIComponent(recent.html));
                        options.autoSave = JSON.parse(document.querySelector('*[onclick="functions.toggleSimpleOption(event, \'autoSave\')"]').dataset.value);
                    } else {
                        editorHTML.setValue(decodeURIComponent(save[id].html));
                        editorJS.setValue(decodeURIComponent(save[id].js));
                        document.querySelector('.popup-close').click();
                    }
                } else if (f == "remove") {
                    if (confirm(`Are you certain you would like to delete ${save[id].name}?`)) {
                        save.splice(id, 1);
                    } else {
                        alert('Canceled!');
                    }
                }

                localStorage.setItem('ashcodeData', JSON.stringify({
                    save: save,
                    recent: recent,
                    options: options
                }))
                let html = functions.generateHTML("save");
                if (document.querySelector('.popup-content')) document.querySelector('.popup-content').innerHTML = html;

            }
        });
        document.addEventListener("keydown", (e) => {
            if (e.key.toLowerCase() == "s" && e.ctrlKey) {
                e.preventDefault();
                functions.saveAndLoad(true);
            }
            if (e.key.toLowerCase() == "o" && e.ctrlKey) {
                e.preventDefault();
                functions.saveAndLoad(false);
            }
            if (e.key.toLowerCase() == "i" && e.ctrlKey) {
                e.preventDefault();
                document.querySelector('span[onclick="functions.toggleConsole()"]').click()
            }
            if (e.key.toLowerCase() == "f" && e.ctrlKey) {
                e.preventDefault();
                functions.fullscreen()
            }
        })
        window.addEventListener('beforeunload', function (event) {
            event.preventDefault();
            event.returnValue = '';
            return 'Are you sure you want to leave? You might lose unsaved content.';
        });
        window.itemHistory = [];
        window.item = 0
        document.getElementById('send').addEventListener("keydown", (e) => {
            if (e.key == "Enter") {
                document.getElementById('log').innerHTML += `<div class="info">${e.target.value}</div>`;
                document.getElementsByTagName('iframe')[0].contentWindow.postMessage(e.target.value, "*");
                if (itemHistory[itemHistory.length - 1] !== e.target.value) {
                    itemHistory.push(e.target.value)
                    item = itemHistory.length
                }
                e.target.value = "";
            }
            if (e.key == "ArrowUp") {
                item--;
                if (item < 0) item = 0
                document.getElementById('send').value = itemHistory[item]
            }
            if (e.key == "ArrowDown") {
                item++;
                if (item > itemHistory.length - 1) item = itemHistory.length - 1
                document.getElementById('send').value = itemHistory[item]
            }
        })
        setInterval(() => {
            if (document.querySelector('.popup-container')) {
                document.querySelector('.ace_editor').style.zIndex = "-1";
            } else if (document.querySelector('.ace_editor')) {
                document.querySelector('.ace_editor').style.zIndex = "";
            }
        }, 10)
        window.addEventListener('message', (e) => {
            if (e.data.vscodeScheduleAsyncWork) return
            console.log(e)
            if (e.data.type === 'log') {
                document.getElementById('log').innerHTML += `<div class="message"></div>`;
                functions.displayJSON(e.data.message, document.querySelector('#log>.message:last-child'));
            }
            if (e.data.type === 'warn') {
                document.getElementById('log').innerHTML += `<div class="warn">${e.data.message}</div>`;
            }
            if (e.data.type === 'error') {
                document.getElementById('log').innerHTML += `<div class="error">${e.data.message}</div>`;
            }
            if (e.data.type === 'message') {
                document.getElementById('log').innerHTML += `<div class="infoB"></div>`;
                functions.displayJSON(e.data.message, document.querySelector('#log>.infoB:last-child'));
            }
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
        });

        functions.displayJSON = function (inputString, outputElement) {
            if (typeof inputString == "object") {
                functions.displayObject(inputString, outputElement, 0);
                console.log('parsed object');
            } else {

                outputElement.innerHTML = inputString;
                console.log('obj unable to parse');
            }

        }

        functions.downloadWorkspace = function () {
            let name = prompt("Project Name", "index");
            const exportUrl = `data:text/plain;charset=utf-8,${encodeURIComponent(editorHTML.env.editor.getValue() + "<script>" + editorJS.getValue() + "<\/script>")}`;
            console.log(name);
            const link = document.createElement("a");
            link.download = `${name}.html`;
            link.href = exportUrl;
            link.click();
            link.remove();
        }

        functions.importWorkspace = function () {
            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = ".html";
            fileInput.click();
            fileInput.addEventListener("change", () => {
                if (fileInput.files[0]) {
                    let file = fileInput.files[0];
                    if (file.type == "text/html") {
                        file.text().then((content) => {
                            editorHTML.setValue(content);
                        });
                    } else {
                        alert("File must be in the HTML format.");
                    };
                };
            });
        };

        functions.exportAll = function () {
            localStorage.setItem('ashcodeData', JSON.stringify({
                save: save,
                recent: recent,
                options: options
            }))
            const exportUrl = `data:application/json;charset=utf-8,${encodeURIComponent(JSON.stringify(localStorage.getItem('ashcodeData')))}`
            const link = document.createElement("a")
            link.download = `Ash-Code-backup - ${new Date().toLocaleDateString().replaceAll("/", "-") + ", " + new Date().toLocaleTimeString().replaceAll("/", "-")}.json`
            link.href = exportUrl
            link.click()
            link.remove()
        }

        functions.importAll = function () {
            const fileInput = document.createElement("input")
            fileInput.type = "file"
            fileInput.accept = ".json"
            fileInput.click()
            fileInput.addEventListener("change", () => {
                if (fileInput.files[0]) {
                    let file = fileInput.files[0]
                    if (file.type == "application/json") {
                        file.text().then((content) => {
                            let parsed = JSON.parse(content)
                            if (parsed) {
                                localStorage.setItem('ashcodeData', JSON.parse(content))
                                window.location.reload()
                            } else {
                                alert("Invalid JSON document")
                            }
                        })
                    } else {
                        alert("File must be in the JSON format.")
                    }
                }
            })
        }

        functions.displayObject = function (obj, parentElement, depth, wkey = null) {
            if (depth >= 10 && !options.infiniteObjectNesting || depth >= 100 && options.infiniteObjectNesting) {
                parentElement.innerHTML += "<p>Object is nested too deeply</p>";
                return;
            }
            const details = document.createElement("details");
            const summary = document.createElement("summary");
            details.style.paddingLeft = "10px"
            if (wkey !== null) {
                summary.innerText = wkey;
            } else {
                summary.innerText = "object";
            }
            details.appendChild(summary);
            parentElement.appendChild(details);
            for (const [key, value] of Object.entries(obj)) {
                const element = document.createElement("div");
                if (typeof value === "object" && value !== null) {
                    functions.displayObject(value, element, depth + 1, key);
                } else {
                    element.innerHTML = `${key}: ${value}`;
                }
                details.appendChild(element);
            }
        }

        functions.toggleConsole = function () {
            if (event.target.dataset.value == "false") {
                event.target.dataset.value = "true"
                document.getElementById("console").style.display = "block"
            } else {
                event.target.dataset.value = "false"
                document.getElementById("console").style.display = "none"
            }
        }

        functions.toggleSimpleOption = function (event, optionToToggle) {
            if (event.target.dataset.value == "false") {
                event.target.dataset.value = "true";
                options[optionToToggle] = true
            } else {
                event.target.dataset.value = "false"
                options[optionToToggle] = false;
            }
            localStorage.setItem('ashcodeData', JSON.stringify({
                save: save,
                recent: recent,
                options: options
            }))
            document.querySelector('#controls>*:last-child').style.display = options.autoUpdate ? "none" : "unset"
        }

        functions.toggleEnableEmmet = function () {
            if (event.target.dataset.value == "false") {
                event.target.dataset.value = "true"
                editorHTML.setOptions({
                    enableEmmet: true
                })
            } else {
                event.target.dataset.value = "false"
                editorHTML.setOptions({
                    enableEmmet: false
                })
            }
        }

        functions.updateTabSize = function () {
            var tabSize = prompt("New Tab Size, 1-8", '4');
            if (parseInt(tabSize) !== NaN) {
                tabSize = parseInt(tabSize)
                if (tabSize >= 1 && tabSize <= 8) {
                    editorJS.getModel().updateOptions({ tabSize: tabSize })
                    editorHTML.session.$tabSize = tabSize;
                    localStorage.setItem('ashcodeData', JSON.stringify({
                        save: save,
                        recent: recent,
                        options: options
                    }))
                }
            }
        }

        functions.updateAutoUpdateTimer = function () {
            var newTimeBeforeUpdate = prompt("Time with no input before auto update (seconds)", options.timeBeforeUpdate);
            if (parseFloat(newTimeBeforeUpdate) !== NaN) {
                let time = parseFloat(newTimeBeforeUpdate);
                if (time >= 0 && time < 10) {
                    options.timeBeforeUpdate = Math.round(time);
                    localStorage.setItem('ashcodeData', JSON.stringify({
                        save: save,
                        recent: recent,
                        options: options
                    }))
                } else alert('please enter a time greater or equal than 0 seconds and less than 10 seconds');
            } else alert('Please make sure that the time entered is a number')
        }
    </script>
</body>

</html>